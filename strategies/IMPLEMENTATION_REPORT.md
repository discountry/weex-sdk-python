# åŠ¨æ€å•è¾¹ç½‘æ ¼ç­–ç•¥ - å®ç°å®ŒæˆæŠ¥å‘Š

## âœ… å®ç°æ¦‚è¿°

åŸºäº weex-sdk å¼€å‘äº†ä¸€ä¸ªå®Œæ•´çš„åŠ¨æ€å•è¾¹ç½‘æ ¼äº¤æ˜“ç­–ç•¥ï¼Œæ”¯æŒåšå¤šå’Œåšç©ºä¸¤ä¸ªæ–¹å‘ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- åŠ¨æ€ç½‘æ ¼åŒºé—´ï¼šå›´ç»•æœ€æ–°æˆäº¤ä»·ä¸Šä¸‹ Â±3%ï¼ˆå¯é…ç½®ï¼‰çš„èŒƒå›´å¸ƒè®¾ç½‘æ ¼
- ç­‰ç™¾åˆ†æ¯”åˆ†å¸ƒï¼šç½‘æ ¼ä»·æ ¼é‡‡ç”¨ç­‰ç™¾åˆ†æ¯”é—´éš”åˆ†å¸ƒ
- è‡ªåŠ¨è®¢å•ç®¡ç†ï¼šä¹°å•/å–å•æˆäº¤åè‡ªåŠ¨æŒ‚å‡ºå¯¹åº”å¹³ä»“å•/å¼€ä»“å•
- æ­¢æŸåŠŸèƒ½ï¼šç”¨æˆ·è®¾ç½®ç»å¯¹äºæŸé‡‘é¢ï¼Œæµ®åŠ¨äºæŸè¾¾åˆ°æ—¶è‡ªåŠ¨å¹³ä»“
- çŠ¶æ€æŒä¹…åŒ–ï¼šæ”¯æŒç­–ç•¥é‡å¯åè‡ªåŠ¨æ¢å¤
- WebSocket é›†æˆï¼šå®æ—¶æ¥æ”¶ä»·æ ¼ã€è®¢å•å’ŒæŒä»“æ›´æ–°
- ç½‘æ ¼é‡æ–°å¸ƒè®¾ï¼šä»·æ ¼è¶…å‡ºèŒƒå›´æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—å¹¶å¸ƒè®¾ç½‘æ ¼

## ğŸ“ ç›®å½•ç»“æ„

```
strategies/
â”œâ”€â”€ __init__.py                 # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ exceptions.py                # ç­–ç•¥ä¸“ç”¨å¼‚å¸¸
â”œâ”€â”€ grid_level.py               # ç½‘æ ¼å±‚çº§æ¨¡å‹
â”œâ”€â”€ price_calculator.py         # ä»·æ ¼è®¡ç®—å·¥å…·
â”œâ”€â”€ order_manager.py            # è®¢å•ç®¡ç†å™¨
â”œâ”€â”€ state_manager.py            # çŠ¶æ€æŒä¹…åŒ–ç®¡ç†å™¨
â”œâ”€â”€ websocket_manager.py        # WebSocket ç®¡ç†
â”œâ”€â”€ grid_strategy.py           # ä¸»ç­–ç•¥ç±»
â”œâ”€â”€ README.md                  # ç­–ç•¥æ–‡æ¡£
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â”œâ”€â”€ run_long_strategy.py    # åšå¤šç­–ç•¥ç¤ºä¾‹
â”‚   â””â”€â”€ run_short_strategy.py   # åšç©ºç­–ç•¥ç¤ºä¾‹
â””â”€â”€ __tests__/
    â””â”€â”€ test_price_calculator.py # ä»·æ ¼è®¡ç®—å•å…ƒæµ‹è¯•
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. GridLevel (ç½‘æ ¼å±‚çº§æ¨¡å‹)
- çŠ¶æ€æœºï¼šEMPTY, OPENING, HOLDING, CLOSING
- è®¢å• ID è¿½è¸ªï¼ˆå¼€ä»“å•ã€å¹³ä»“å•ï¼‰
- æˆäº¤ä¿¡æ¯è®°å½•ï¼ˆæˆäº¤ä»·ã€æˆäº¤æ—¶é—´ï¼‰
- ç›ˆäºè¿½è¸ª

### 2. PriceCalculator (ä»·æ ¼è®¡ç®—å·¥å…·)
- ç­‰ç™¾åˆ†æ¯”åˆ†å¸ƒè®¡ç®—ç½‘æ ¼ä»·æ ¼
- ä»·æ ¼è°ƒæ•´åˆ°äº¤æ˜“æ‰€è§„å®šçš„æ­¥é•¿
- ç½‘æ ¼åŒºé—´åˆ¤æ–­
- ä¸‹ä¸€ä¸ªç½‘æ ¼ä»·æ ¼æŸ¥æ‰¾

### 3. OrderManager (è®¢å•ç®¡ç†å™¨)
- ä¸‹å•åŠŸèƒ½ï¼ˆå¼€ä»“å•ã€å¹³ä»“å•ï¼‰
- æ’¤å•åŠŸèƒ½ï¼ˆå•ä¸ªè®¢å•ã€å…¨éƒ¨è®¢å•ï¼‰
- å¹³ä»“åŠŸèƒ½ï¼ˆå¸‚ä»·å¹³ä»“ï¼‰
- è®¢å•çŠ¶æ€æŸ¥è¯¢
- æŒä»“ä¿¡æ¯æŸ¥è¯¢
- æµ®åŠ¨ç›ˆäºè®¡ç®—

### 4. StateManager (çŠ¶æ€æŒä¹…åŒ–)
- ä¿å­˜ç­–ç•¥çŠ¶æ€åˆ° JSON æ–‡ä»¶
- åŠ è½½ç­–ç•¥çŠ¶æ€
- çŠ¶æ€åŸå­æ€§å†™å…¥ï¼ˆä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼‰

### 5. WebSocketManager (WebSocket ç®¡ç†)
- è®¢é˜… ticker é¢‘é“ï¼ˆä»·æ ¼æ›´æ–°ï¼‰
- è®¢é˜… order é¢‘é“ï¼ˆè®¢å•æ›´æ–°ï¼‰
- è®¢é˜… position é¢‘é“ï¼ˆæŒä»“æ›´æ–°ï¼‰
- è¿æ¥ç®¡ç†

### 6. GridStrategy (ä¸»ç­–ç•¥ç±»)
- ç­–ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå¯åŠ¨ã€åœæ­¢ï¼‰
- ä»·æ ¼ç›‘æ§å’Œç½‘æ ¼é‡æ–°å¸ƒè®¾
- è®¢å•çŠ¶æ€è·Ÿè¸ª
- æ­¢æŸç›‘æ§å’Œæ‰§è¡Œ
- çŠ¶æ€æŒä¹…åŒ–

## ğŸ“Š ç­–ç•¥é€»è¾‘

### åšå¤šæ–¹å‘

1. åˆå§‹åŒ–ï¼š
   - è·å–å½“å‰ä»·æ ¼ P
   - è®¡ç®—ä»·æ ¼åŒºé—´ï¼š[P Ã— (1-3%), P Ã— (1+3%)]
   - ä½¿ç”¨ç­‰ç™¾åˆ†æ¯”åˆ†å¸ƒç”Ÿæˆ N ä¸ªç½‘æ ¼ä»·æ ¼
   - åœ¨æ‰€æœ‰ç½‘æ ¼ä»·æ ¼æŒ‚ä¹°å•

2. ä¹°å•æˆäº¤åï¼š
   - åœ¨ä¸‹ä¸€ä¸ªæ›´é«˜çš„ç½‘æ ¼ä»·æ ¼æŒ‚å–å•

3. å–å•æˆäº¤åï¼š
   - åœ¨å½“å‰ç½‘æ ¼ä»·æ ¼é‡æ–°æŒ‚ä¹°å•
   - å®Œæˆä¸€è½®ç½‘æ ¼

4. ç½‘æ ¼é‡æ–°å¸ƒè®¾ï¼š
   - å½“ä»·æ ¼è¶…å‡ºå½“å‰åŒºé—´
   - å–æ¶ˆæœªæˆäº¤çš„å¼€ä»“å•
   - ä¿ç•™å·²æˆäº¤æŒä»“çš„å¹³ä»“å•ï¼ˆåŸå®šå¹³ä»“ä»·ä¸å˜ï¼‰
   - é‡æ–°è®¡ç®—æ–°åŒºé—´å¹¶å¸ƒè®¾ç½‘æ ¼

5. æ­¢æŸï¼š
   - ç›‘æ§æµ®åŠ¨ç›ˆäº
   - å½“æµ®åŠ¨äºæŸ >= æ­¢æŸé‡‘é¢æ—¶ï¼Œå¸‚ä»·å¹³æ‰æ‰€æœ‰æŒä»“å¹¶å–æ¶ˆæ‰€æœ‰æŒ‚å•

### åšç©ºæ–¹å‘

- åˆå§‹ï¼šåœ¨æ‰€æœ‰ç½‘æ ¼ä»·æ ¼æŒ‚å–å•
- å–å•æˆäº¤åï¼šåœ¨ä¸‹ä¸€ä¸ªæ›´ä½çš„ç½‘æ ¼ä»·æ ¼æŒ‚ä¹°å•
- ä¹°å•æˆäº¤åï¼šåœ¨å½“å‰ç½‘æ ¼ä»·æ ¼é‡æ–°æŒ‚å–å•
- å…¶ä»–é€»è¾‘åŒåšå¤šæ–¹å‘

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åšå¤šç­–ç•¥

```python
import os
import time
from dotenv import load_dotenv
from weex_sdk import WeexClient, WeexWebSocket
import sys
import logging

sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))
import strategies

load_dotenv()

client = WeexClient(
    api_key=os.getenv("API_KEY"),
    secret_key=os.getenv("SECRET_KEY"),
    passphrase=os.getenv("PASSPHRASE"),
)

ws = WeexWebSocket(
    api_key=os.getenv("API_KEY"),
    secret_key=os.getenv("SECRET_KEY"),
    passphrase=os.getenv("PASSPHRASE"),
    is_private=True
)

strategy = strategies.GridStrategy(
    client=client,
    ws=ws,
    symbol="cmt_btcusdt",
    direction="long",
    grid_count=10,
    size_per_grid=0.01,
    price_range_percent=0.03,
    stop_loss_amount=50.0,
    margin_mode=1,
    state_file=f"long_grid_cmt_btcusdt.json",
    log_level=logging.INFO
)

strategy.start()

while strategy.is_running:
    time.sleep(1)

strategy.stop()
```

### åšç©ºç­–ç•¥

```python
strategy = strategies.GridStrategy(
    client=client,
    ws=ws,
    symbol="cmt_btcusdt",
    direction="short",
    grid_count=10,
    size_per_grid=0.01,
    price_range_percent=0.03,
    stop_loss_amount=50.0,
    margin_mode=1,
    state_file=f"short_grid_cmt_btcusdt.json",
    log_level=logging.INFO
)

strategy.start()
```

## ğŸ“‹ é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `symbol` | str | - | äº¤æ˜“å¯¹ï¼ˆå¦‚ "cmt_btcusdt"ï¼‰ |
| `direction` | str | - | æ–¹å‘ï¼š"long" æˆ– "short" |
| `grid_count` | int | - | ç½‘æ ¼æ•°é‡ |
| `size_per_grid` | float | - | æ¯ä¸€æ ¼çš„æ•°é‡ï¼ˆåˆçº¦å•ä½ï¼‰ |
| `price_range_percent` | float | 0.03 | ä»·æ ¼åŒºé—´ç™¾åˆ†æ¯”ï¼ˆå¦‚ 0.03 = 3%ï¼‰ |
| `stop_loss_amount` | float | 0.0 | æ­¢æŸé‡‘é¢ï¼ˆUSDTï¼‰ï¼Œ0 è¡¨ç¤ºæ— æ­¢æŸ |
| `margin_mode` | int | 1 | ä¿è¯é‡‘æ¨¡å¼ï¼š1ï¼ˆå…¨ä»“ï¼‰æˆ– 3ï¼ˆé€ä»“ï¼‰ |
| `state_file` | str | - | çŠ¶æ€æ–‡ä»¶è·¯å¾„ |
| `log_level` | int | - | æ—¥å¿—çº§åˆ«ï¼ˆå¦‚ logging.INFOï¼‰ |

## âœ… æµ‹è¯•

å·²åˆ›å»ºå•å…ƒæµ‹è¯•æ–‡ä»¶ `strategies/__tests__/test_price_calculator.py`ï¼ŒåŒ…å«ä»¥ä¸‹æµ‹è¯•ï¼š

- ç­‰ç™¾åˆ†æ¯”åˆ†å¸ƒè®¡ç®—ï¼ˆåšå¤š/åšç©ºï¼‰
- ç½‘æ ¼é‡æ–°å¸ƒè®¾æ¡ä»¶åˆ¤æ–­
- ä»·æ ¼è°ƒæ•´åˆ°æ­¥é•¿
- ä¸‹ä¸€ä¸ªç½‘æ ¼ä»·æ ¼æŸ¥æ‰¾

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **API å‡­è¯**ï¼šéœ€è¦åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½® API å‡­è¯
2. **èµ„é‡‘å ç”¨**ï¼šç¡®ä¿è´¦æˆ·æœ‰è¶³å¤Ÿä¿è¯é‡‘æ”¯æŒæ‰€æœ‰ç½‘æ ¼è®¢å•
3. **ä»·æ ¼ç²¾åº¦**ï¼šç­–ç•¥è‡ªåŠ¨éµå¾ªäº¤æ˜“æ‰€çš„ tick_size è¦æ±‚
4. **æ­¢æŸæ»‘ç‚¹**ï¼šå¸‚ä»·å¹³ä»“å¯èƒ½å­˜åœ¨æ»‘ç‚¹ï¼Œå»ºè®®è®¾ç½®é€‚å½“çš„æ­¢æŸç¼“å†²
5. **ç½‘ç»œè¿æ¥**ï¼šåˆ©ç”¨ weex_sdk çš„ WebSocket è‡ªåŠ¨é‡è¿æœºåˆ¶

## ğŸ”„ æ¢å¤é€»è¾‘

ç­–ç•¥å¯åŠ¨æ—¶ï¼š
1. æ£€æŸ¥çŠ¶æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. å¦‚æœå­˜åœ¨ï¼šåŠ è½½çŠ¶æ€ã€éªŒè¯è®¢å•æœ‰æ•ˆæ€§ã€æ¢å¤æ“ä½œ
3. å¦‚æœä¸å­˜åœ¨ï¼šä»é›¶å¼€å§‹å¸ƒè®¾ç½‘æ ¼

çŠ¶æ€æ–‡ä»¶åŒ…å«ï¼š
- å½“å‰ä»·æ ¼å’Œç½‘æ ¼è¾¹ç•Œ
- æ‰€æœ‰ç½‘æ ¼å±‚çº§åŠå…¶çŠ¶æ€
- è®¢å• ID å’Œæˆäº¤ä¿¡æ¯
- å·²å®ç°ç›ˆäº
- å¯åŠ¨æ—¶é—´

## âš ï¸ é£é™©æç¤º

ç½‘æ ¼äº¤æ˜“æ¶‰åŠæ˜¾è‘—é£é™©ã€‚è¿‡å»çš„è¡¨ç°ä¸ä»£è¡¨æœªæ¥çš„ç»“æœã€‚è¯·ï¼š

1. æµ‹è¯•æ—¶ä»å°é‡‘é¢å¼€å§‹
2. è®¾ç½®é€‚å½“çš„æ­¢æŸ
3. å®šæœŸç›‘æ§ç­–ç•¥è¿è¡Œ
4. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ä¿è¯é‡‘

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è®¿é—®ï¼šhttps://github.com/discountry/weex-sdk-python/issues

---

å®ç°å®Œæˆæ—¶é—´ï¼š2024å¹´12æœˆ24æ—¥
å®ç°è€…ï¼šopencode
